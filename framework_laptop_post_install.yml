# This is meant to set up additional software for Framework laptops running Fedora 35

# Power Management
# Change sleep from s2idle to deep
# sudo grubby --update-kernel=ALL --args=mem_sleep_default=deep
# This makes closing the lid not put the device to sleep however suspend appears
# to actually suspend to ram
# Check sleep state with: cat /sys/power/mem_sleep
# Powertop
# sudo dnf install powertop
# TLP
# sudo dnf install tlp
# sudo dnf remove power-profiles-daemon
# sudo systemctl enable tlp.service
# sudo systemctl mask systemd-rfkill.service systemd-rfkill.socket
# Add PCIE_ASPM_ON_BAT=powersupersave to /etc/tlp.conf
# sudo tlp start

# ACTUALLY WORKS:
# Improve s2idle suspend battery life:
# sudo grubby --update-kernel=ALL --args=nvme.noacpi=1
# Allow s2idle/modern standby to work on Fedora 35:
# sudo grubby --update-kernel=ALL --args='"acpi_osi=!Windows 2020"'

# For battery thresholds with TLP: https://old.reddit.com/r/thinkpad/comments/og5anr/til_battery_charging_thresholds_best_practices/
# START_CHARGE_THRESH_BAT0=75
# STOP_CHARGE_THRESH_BAT0=80
# Add the above to /etc/tlp.conf



# Fractional Scaling
# gsettings set org.gnome.mutter experimental-features "['scale-monitor-framebuffer']"
# Turn off with gsettings reset org.gnome.mutter experimental-features
# This makes VSCodium look blurry

# Audio Jack Mic-In


# Tiger Lake iGPU Hardware Acceleration:
# intel-media-driver is needed for Tiger Lake and newer
# sudo dnf install intel-media-driver
# sudo dnf install igt-gpu-tools

# VAAPI for Fedora 35:
# sudo dnf install libva-utils
# sudo dnf install ffmpeg

# If you have the Tempo audio codec Framework mainboard, you need to disable it to achieve PC10 residency:
# sudo su
# echo 9 | sudo tee /sys/kernel/debug/pmc_core/ltr_ignore
# Unofortunately, this doesn't work on Fedora 35 with Secure Boot enabled. Not sure why
